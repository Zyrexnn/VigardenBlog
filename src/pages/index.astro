---
import Layout from "../layouts/Layout.astro";
import VioletHero from "../components/VioletHero.astro";
import ThemeController from "../components/ThemeController.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const latestPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 3);
---

<Layout title="Vigarden | Auto Memories Doll Room">
  <ThemeController slot="header-right" />

  <!-- Hero Banner Area (Refined Mizuki Ref) -->
  <section class="relative h-[70vh] min-h-[550px] w-full flex flex-col items-center justify-center text-center overflow-hidden bg-[#0D1117]">
    
    <!-- Background GIF -->
    <div class="absolute inset-0 z-0">
      <img
        id="theme-gif"
        src="/images/violet-light.gif"
        alt=""
        class="w-full h-full object-cover opacity-80"
        loading="eager"
      />
      <!-- Soft Gradient Overlay -->
      <div class="absolute inset-0 bg-gradient-to-tr from-black/40 via-transparent to-black/20"></div>
    </div>

    <!-- Content Over GIF -->
    <div class="z-30 space-y-8 px-6 mb-12" transition:animate="fade">
      <div class="space-y-4">
        <h1 class="text-7xl md:text-[10rem] font-heading text-white drop-shadow-[0_15px_15px_rgba(0,0,0,0.6)] tracking-tighter leading-none">
          „Çè„Åü„Åó„ÅÆÈÉ®Â±ã
        </h1>
        <p class="font-body text-white/90 tracking-[0.8em] text-xs sm:text-base uppercase drop-shadow-md opacity-80">
          ‚Äî Auto Memories Doll Service ‚Äî
        </p>
      </div>

      <div class="flex flex-col items-center gap-4">
        <div class="w-16 h-[2px] bg-white/30 rounded-full"></div>
        <p class="text-white/80 font-sans italic text-sm tracking-[0.1em] drop-shadow-sm max-w-lg leading-relaxed">
          "Sincerely, delivering the unspoken feelings of the world."
        </p>
      </div>
    </div>
    
    <!-- Floating Violet Hero (Tidied positioning) -->
    <div class="absolute bottom-16 left-8 sm:left-32 z-40 transform scale-90 sm:scale-125 origin-bottom pointer-events-none drop-shadow-[0_20px_50px_rgba(0,0,0,0.5)]">
       <VioletHero />
    </div>

    <!-- üåä REFINED MOVING OCEAN üåä -->
    <div class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20">
      <svg class="moving-wave" xmlns="http://www.w3.org/2000/svg" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use href="#gentle-wave" x="48" y="0" fill="currentColor" class="text-paper/20 dark:text-dark-bg/20" />
          <use href="#gentle-wave" x="48" y="3" fill="currentColor" class="text-paper/40 dark:text-dark-bg/40" />
          <use href="#gentle-wave" x="48" y="5" fill="currentColor" class="text-paper/60 dark:text-dark-bg/60" />
          <use href="#gentle-wave" x="48" y="7" fill="currentColor" class="text-paper dark:text-dark-bg" />
        </g>
      </svg>
    </div>
  </section>

  <!-- Main Content Grid -->
  <main class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-20 relative z-30">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
      
      <!-- Left Column: Blog Posts -->
      <div class="lg:col-span-8 space-y-12">
        <div class="flex items-center justify-between mb-10">
          <div class="flex items-center gap-5">
            <div class="w-1.5 h-10 bg-accent rounded-full shadow-[0_0_15px_rgba(79,172,254,0.4)]"></div>
            <div>
              <h2 class="text-4xl font-heading text-primary dark:text-accent tracking-tight">ÊúÄÊñ∞„ÅÆÊõ∏Á∞°</h2>
              <p class="text-[10px] uppercase tracking-[0.4em] opacity-40 font-semibold mt-1">Latest Letters Archive</p>
            </div>
          </div>
          <div class="hidden sm:block h-px flex-1 bg-gold/10 mx-10"></div>
        </div>

        <div class="space-y-8">
          {latestPosts.map(post => (
            <a href={`/blog/${post.id}/`} class="group block">
              <article class="relative bg-white dark:bg-dark-card border border-gold/5 dark:border-white/5 rounded-[2.5rem] p-10 flex flex-col md:flex-row gap-10 hover:shadow-[0_30px_60px_rgba(0,0,0,0.1)] dark:hover:shadow-[0_30px_60px_rgba(0,0,0,0.4)] hover:border-accent/20 transition-all duration-700 backdrop-blur-md group-hover:-translate-y-2">
                 <!-- Modern Card Accent -->
                 <div class="absolute top-10 left-0 w-1.5 h-20 bg-gold/10 group-hover:bg-accent transition-all duration-500 rounded-r-full"></div>
                 
                 <div class="flex-1 space-y-6">
                   <div class="flex flex-wrap items-center gap-6 text-[10px] font-body text-ink/40 dark:text-white/30 tracking-widest uppercase font-bold">
                      <span class="flex items-center gap-2"><span class="text-gold opacity-50 text-sm">üìÖ</span> {post.data.pubDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                      <span class="flex items-center gap-2"><span class="text-gold opacity-50 text-sm">üè∑Ô∏è</span> {post.data.category}</span>
                   </div>

                   <h3 class="text-3xl md:text-4xl font-heading text-primary dark:text-dark-text group-hover:text-gold dark:group-hover:text-accent transition-colors duration-500 leading-tight">
                      {post.data.title}
                   </h3>
                   
                   <p class="text-ink/60 dark:text-white/50 font-sans leading-relaxed line-clamp-2 text-lg">
                      {post.data.description}
                   </p>

                   <div class="flex gap-3 pt-2">
                      {post.data.tags.map(tag => (
                        <span class="text-[9px] bg-gold/5 dark:bg-white/5 text-gold/60 dark:text-accent/60 px-4 py-1.5 rounded-full border border-gold/10 dark:border-accent/10 uppercase tracking-widest font-bold group-hover:border-accent/30 transition-colors">#{tag}</span>
                      ))}
                   </div>
                 </div>

                 <div class="shrink-0 flex items-center justify-center">
                    <div class="w-16 h-16 rounded-3xl border border-gold/10 dark:border-white/10 flex items-center justify-center group-hover:bg-accent group-hover:border-accent group-hover:text-white transition-all duration-500 shadow-lg transform group-hover:rotate-12">
                      <span class="text-2xl transform group-hover:translate-x-1 transition-transform">‚Üí</span>
                    </div>
                 </div>
              </article>
            </a>
          ))}
        </div>

        <div class="pt-12 text-center">
            <a href="/blog/" class="group inline-flex items-center gap-4 px-16 py-5 border border-gold/20 hover:border-accent hover:text-accent transition-all duration-500 rounded-full font-body text-xs tracking-[0.5em] uppercase bg-paper/20 dark:bg-dark-bg/20 backdrop-blur-xl">
              <span>„Åô„Åπ„Å¶„ÅÆÊâãÁ¥ô (Archive)</span>
              <span class="transform group-hover:translate-x-2 transition-transform">‚ü∂</span>
            </a>
        </div>
      </div>

      <!-- Right Column: Sidebar (Tidied) -->
      <aside class="lg:col-span-4 space-y-12">
        <!-- Sidebar Widget: Stats -->
        <div class="bg-white/40 dark:bg-dark-card/40 border border-gold/5 dark:border-white/5 rounded-[2.5rem] p-10 backdrop-blur-xl shadow-xl space-y-10">
          <div class="space-y-2">
            <div class="w-12 h-1 bg-accent/40 rounded-full"></div>
            <h3 class="font-heading text-2xl tracking-tighter">Áµ±Ë®àÊÉÖÂ†±</h3>
            <p class="text-[10px] uppercase tracking-[0.3em] opacity-30 font-bold">Data & Statistics</p>
          </div>

          <ul class="space-y-8 font-sans">
            <li class="flex justify-between items-end border-b border-gold/5 pb-4 group">
               <span class="text-ink/50 dark:text-white/40 text-sm tracking-wide group-hover:text-accent transition-colors">üìÑ Á®øÁ®ø (Posts)</span>
               <span class="font-heading text-3xl text-gold group-hover:scale-110 transition-transform origin-right">{posts.length}</span>
            </li>
            <li class="flex justify-between items-end border-b border-gold/5 pb-4 group">
               <span class="text-ink/50 dark:text-white/40 text-sm tracking-wide group-hover:text-accent transition-colors">üìÅ „Ç´„ÉÜ„Ç¥„É™„Éº</span>
               <span class="font-heading text-3xl text-gold group-hover:scale-110 transition-transform origin-right">3</span>
            </li>
            <li class="flex justify-between items-end border-b border-gold/5 pb-4 group">
               <span class="text-ink/50 dark:text-white/40 text-sm tracking-wide group-hover:text-accent transition-colors">üè∑Ô∏è „Çø„Ç∞</span>
               <span class="font-heading text-3xl text-gold group-hover:scale-110 transition-transform origin-right">10</span>
            </li>
          </ul>
        </div>

        <!-- Sidebar Widget: Music (Aesthetics refined) -->
        <div class="bg-gradient-to-br from-primary/20 via-accent/5 to-gold/10 border border-gold/10 dark:border-white/10 rounded-[2.5rem] p-10 backdrop-blur-xl relative overflow-hidden group shadow-2xl">
           <div class="absolute -right-20 -top-20 w-48 h-48 bg-accent/10 rounded-full blur-3xl group-hover:bg-accent/20 transition-all duration-1000"></div>
           
           <div class="relative z-10 flex flex-col items-center text-center gap-6">
              <div class="relative">
                <div class="w-24 h-24 bg-white/5 rounded-full border border-white/10 backdrop-blur-2xl flex items-center justify-center text-4xl animate-spin-slow shadow-[0_0_50px_rgba(79,172,254,0.2)]">
                   üíø
                </div>
                <!-- Animated ring -->
                <div class="absolute inset-[-10px] border border-accent/20 rounded-full animate-ping-slow"></div>
              </div>
              
              <div class="space-y-2">
                 <p class="text-[9px] font-body text-accent/60 uppercase tracking-[0.4em] font-bold">Now Playing</p>
                 <h4 class="font-heading text-2xl text-primary dark:text-accent leading-none">Sincerely</h4>
                 <p class="text-sm font-sans opacity-40 italic tracking-widest">‚Äî TRUE (Violet OST)</p>
              </div>

              <!-- Simple Waveform deco -->
              <div class="flex items-end gap-1 h-4 pt-4">
                 <div class="w-1 bg-accent/40 rounded-full animate-wave-1"></div>
                 <div class="w-1 bg-accent/60 rounded-full animate-wave-2"></div>
                 <div class="w-1 bg-accent/40 rounded-full animate-wave-3"></div>
                 <div class="w-1 bg-gold/50 rounded-full animate-wave-1"></div>
                 <div class="w-1 bg-accent/40 rounded-full animate-wave-2"></div>
              </div>
           </div>
        </div>
      </aside>

    </div>
  </main>

  <style>
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-spin-slow {
      animation: spin-slow 15s linear infinite;
    }

    @keyframes ping-slow {
      0% { transform: scale(0.8); opacity: 0.5; }
      100% { transform: scale(1.4); opacity: 0; }
    }
    .animate-ping-slow {
      animation: ping-slow 3s ease-out infinite;
    }

    @keyframes wave {
      0%, 100% { height: 4px; }
      50% { height: 16px; }
    }
    .animate-wave-1 { animation: wave 1s ease-in-out infinite; }
    .animate-wave-2 { animation: wave 1.2s ease-in-out infinite; }
    .animate-wave-3 { animation: wave 0.8s ease-in-out infinite; }

    /* üåä Ocean Waves üåä */
    .moving-wave {
      width: 100%;
      height: 140px;
    }

    .parallax > use {
      animation: move-forever 25s cubic-bezier(.55,.5,.45,.5) infinite;
    }
    .parallax > use:nth-child(1) { animation-delay: -2s; animation-duration: 7s; }
    .parallax > use:nth-child(2) { animation-delay: -3s; animation-duration: 10s; }
    .parallax > use:nth-child(3) { animation-delay: -4s; animation-duration: 13s; }
    .parallax > use:nth-child(4) { animation-delay: -5s; animation-duration: 20s; }

    @keyframes move-forever {
      0% { transform: translate3d(-90px,0,0); }
      100% { transform: translate3d(85px,0,0); }
    }

    @media (max-width: 768px) {
      .moving-wave { height: 60px; }
      .text-9xl { font-size: 5rem; }
    }
  </style>
</Layout>
