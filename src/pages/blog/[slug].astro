---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection, render } from "astro:content";
import { marked } from "marked";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

// Parse JP and ID markdown content from frontmatter
const bodyJpHtml = post.data.body_jp
  ? await marked.parse(post.data.body_jp)
  : "";
const bodyIdHtml = post.data.body_id
  ? await marked.parse(post.data.body_id)
  : "";
---

<Layout
  title={`${post.data.title} | Vigarden`}
  description={post.data.description}
>
  <ThemeController slot="header-right" />

  <div class="bg-paper dark:bg-[#0D1117] relative">
    <!-- Hero Banner -->
    <section
      class="relative h-[40vh] sm:h-[50vh] min-h-[300px] sm:min-h-[400px] w-full flex flex-col items-center justify-center text-center overflow-hidden"
    >
      <div class="absolute inset-0 z-0">
        <img
          id="theme-gif"
          src="/images/violet-light.gif"
          alt=""
          class="w-full h-full object-cover opacity-10 dark:opacity-30 blur-sm"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-paper/80 via-transparent to-ink/10
                 dark:from-[#0D1117] dark:via-[#0D1117]/20 dark:to-black/40"
        >
        </div>
      </div>

      <div
        class="relative z-10 max-w-4xl px-4 sm:px-8 space-y-4 sm:space-y-6 pt-16"
        transition:animate="fade"
      >
        <div
          class="flex items-center justify-center gap-3 sm:gap-4 text-[9px] sm:text-[10px] font-body text-gold tracking-[0.3em] sm:tracking-[0.4em] uppercase font-bold"
        >
          <span>{post.data.pubDate.toLocaleDateString()}</span>
          <span class="w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full bg-accent/40"
          ></span>
          <span>{post.data.category}</span>
        </div>
        <h1
          class="text-3xl sm:text-4xl md:text-6xl font-heading text-ink dark:text-white drop-shadow-xl tracking-tighter leading-tight"
          data-content-title={post.id}
        >
          <span data-content-lang="en">{post.data.title}</span>
          <span data-content-lang="jp" class="hidden"
            >{post.data.title_jp || post.data.title}</span
          >
          <span data-content-lang="id" class="hidden"
            >{post.data.title_id || post.data.title}</span
          >
        </h1>
        <div
          class="flex justify-center flex-wrap gap-1.5 sm:gap-2 pt-2 sm:pt-4"
        >
          {
            post.data.tags.map((tag: string) => (
              <span class="text-[8px] sm:text-[9px] px-2.5 sm:px-4 py-1 sm:py-1.5 rounded-full border border-ink/10 dark:border-white/10 bg-ink/5 dark:bg-white/5 text-ink/60 dark:text-white/60 uppercase tracking-widest">
                #{tag}
              </span>
            ))
          }
        </div>
      </div>

      <div
        class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none"
      >
        <svg
          class="block w-full h-10 sm:h-12 md:h-20"
          viewBox="0 24 150 28"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <path
              id="wave-post"
              d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
            ></path>
          </defs>
          <use
            href="#wave-post"
            x="48"
            y="7"
            fill="currentColor"
            class="text-paper dark:text-[#0D1117]"></use>
        </svg>
      </div>
    </section>

    <main
      class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 py-10 sm:py-16 relative"
    >
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 sm:gap-12 lg:gap-20">
        <!-- Left Sidebar -->
        <aside
          class="lg:col-span-4 space-y-8 sm:space-y-12 order-2 lg:order-1 lg:sticky lg:top-32"
        >
          <section
            class="bg-white/90 dark:bg-[#161213]/80 border border-ink/10 dark:border-white/5 rounded-2xl sm:rounded-[3rem] p-6 sm:p-10 shadow-2xl flex flex-col items-center text-center"
          >
            <div
              class="w-16 h-16 sm:w-24 sm:h-24 rounded-xl sm:rounded-2xl overflow-hidden border-2 border-ink/10 dark:border-white/10 p-1 mb-4 sm:mb-6 bg-ink/5 dark:bg-white/5 shadow-inner"
            >
              <img
                src="/images/charviolet-removebg-preview.png"
                alt="Author"
                class="w-full h-full object-contain"
              />
            </div>
            <div class="space-y-3 sm:space-y-4">
              <p
                class="text-[8px] sm:text-[9px] font-body text-gold uppercase tracking-[0.3em] sm:tracking-[0.4em] font-bold opacity-80 dark:opacity-60"
                data-i18n="autoMemoriesDoll"
              >
                Auto Memories Doll
              </p>
              <h2
                class="font-heading text-2xl sm:text-3xl text-ink dark:text-white leading-tight"
              >
                Violet Evergarden
              </h2>
              <div
                class="w-10 sm:w-12 h-[1px] bg-gold/30 dark:bg-gold/20 mx-auto"
              >
              </div>
              <p
                class="text-[10px] sm:text-xs font-sans text-ink/60 dark:text-white/40 leading-relaxed italic"
                data-i18n="authorQuote"
              >
                "I will run as fast as I can to wherever my customer desires. I
                am the Auto Memories Doll, Violet Evergarden."
              </p>
            </div>
          </section>

          <a
            href="/blog/"
            class="flex items-center justify-center gap-3 sm:gap-4 py-3 sm:py-4 rounded-xl sm:rounded-2xl border border-ink/10 dark:border-white/5 bg-ink/5 dark:bg-white/5 text-[9px] sm:text-[10px] font-body tracking-[0.3em] sm:tracking-[0.4em] uppercase text-gold hover:text-ink dark:hover:text-white hover:bg-gold/10 transition-all duration-300 group"
          >
            <span
              class="transform group-hover:-translate-x-2 transition-transform"
              >‚üµ</span
            >
            <span data-i18n="back">Back</span>
          </a>
        </aside>

        <!-- Right Column: Article Content -->
        <article class="lg:col-span-8 order-1 lg:order-2 w-full min-w-0">
          <div
            class="bg-white/90 dark:bg-[#161213]/80 border border-ink/10 dark:border-white/5 rounded-2xl sm:rounded-[3rem] p-6 sm:p-10 md:p-14 shadow-2xl relative overflow-hidden"
          >
            <!-- EN Content (Markdown) -->
            <div
              class="prose prose-lg dark:prose-invert prose-gold max-w-none
                      prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14
                      prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3
                      prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/75 prose-p:mb-5
                      prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:not-italic prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                      prose-img:rounded-xl sm:prose-img:rounded-2xl prose-img:shadow-lg prose-img:my-8
                      prose-li:text-ink/80 dark:prose-li:text-white/65 prose-li:leading-[1.8]
                      prose-strong:font-semibold prose-strong:text-ink dark:prose-strong:text-white/90
                      prose-ol:pl-4 prose-ul:pl-4
                      prose-hr:border-ink/10 dark:prose-hr:border-white/10 prose-hr:my-8
                      relative z-10"
              transition:animate="slide"
              data-content-lang="en"
            >
              <Content />
            </div>

            <!-- JP Content -->
            {
              post.data.body_jp && (
                <div
                  class="prose prose-lg dark:prose-invert prose-gold max-w-none
                          prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14
                          prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3
                          prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/75 prose-p:mb-5
                          prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                          prose-img:rounded-xl sm:prose-img:rounded-2xl prose-img:shadow-lg prose-img:my-8
                          prose-li:text-ink/80 dark:prose-li:text-white/65 prose-li:leading-[1.8]
                          prose-strong:font-semibold prose-strong:text-ink dark:prose-strong:text-white/90
                          prose-ol:pl-4 prose-ul:pl-4
                          prose-hr:border-ink/10 dark:prose-hr:border-white/10 prose-hr:my-8
                          relative z-10
                          hidden"
                  data-content-lang="jp"
                  set:html={bodyJpHtml}
                />
              )
            }

            <!-- ID Content -->
            {
              post.data.body_id && (
                <div
                  class="prose prose-lg dark:prose-invert prose-gold max-w-none
                          prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14
                          prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3
                          prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/75 prose-p:mb-5
                          prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                          prose-img:rounded-xl sm:prose-img:rounded-2xl prose-img:shadow-lg prose-img:my-8
                          prose-li:text-ink/80 dark:prose-li:text-white/65 prose-li:leading-[1.8]
                          prose-strong:font-semibold prose-strong:text-ink dark:prose-strong:text-white/90
                          prose-ol:pl-4 prose-ul:pl-4
                          prose-hr:border-ink/10 dark:prose-hr:border-white/10 prose-hr:my-8
                          relative z-10
                          hidden"
                  data-content-lang="id"
                  set:html={bodyIdHtml}
                />
              )
            }
          </div>
        </article>
      </div>
    </main>
  </div>
</Layout>
