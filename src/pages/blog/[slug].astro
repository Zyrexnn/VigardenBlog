---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout
  title={`${post.data.title} | Vigarden`}
  description={post.data.description}
>
  <ThemeController slot="header-right" />

  <!-- Single Post Banner (Tidied) -->
  <article>
    <section
      class="relative h-[50vh] min-h-[400px] w-full flex flex-col items-center justify-center text-center overflow-hidden bg-[#0D1117]"
    >
      <div class="absolute inset-0 z-0">
        <img
          src="/images/violet-dark.gif"
          alt=""
          class="w-full h-full object-cover opacity-30 blur-sm scale-105"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-black/40"
        >
        </div>
      </div>

      <div
        class="z-10 max-w-4xl px-8 space-y-6 pt-16"
        transition:animate="fade"
      >
        <div
          class="flex items-center justify-center gap-4 text-[10px] font-body text-gold tracking-[0.4em] uppercase font-bold"
        >
          <span>{post.data.pubDate.toLocaleDateString()}</span>
          <span class="w-1.5 h-1.5 rounded-full bg-accent/40"></span>
          <span>{post.data.category}</span>
        </div>
        <h1
          class="text-4xl md:text-6xl font-heading text-white drop-shadow-xl tracking-tighter leading-tight"
        >
          {post.data.title}
        </h1>
        <div class="flex justify-center flex-wrap gap-2 pt-4">
          {
            post.data.tags.map((tag) => (
              <span class="text-[9px] px-4 py-1.5 rounded-full border border-white/10 bg-white/5 text-white/60 uppercase tracking-widest">
                #{tag}
              </span>
            ))
          }
        </div>
      </div>

      <!-- Wavy Divider (Flush & No Artifacts) -->
      <div
        class="absolute bottom-[-2px] left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none"
      >
        <svg
          class="block w-full h-12 md:h-20"
          viewBox="0 24 150 28"
          preserveAspectRatio="none"
        >
          <use
            href="#gentle-wave"
            x="48"
            y="7"
            fill="currentColor"
            class="text-paper dark:text-[#0D1117] transition-colors duration-500"
          ></use>
        </svg>
      </div>
    </section>

    <main
      class="max-w-[1600px] mx-auto px-6 sm:px-8 lg:px-12 py-24 relative z-30"
    >
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20">
        <!-- Left Sidebar: Author & Info -->
        <aside
          class="lg:col-span-4 space-y-12 order-2 lg:order-1 lg:sticky lg:top-32"
        >
          <!-- Post Meta Info Card (Refined) -->
          <section
            class="bg-[#1e1a1b]/80 dark:bg-[#161213]/80 border border-white/5 rounded-[3rem] p-10 backdrop-blur-xl shadow-2xl flex flex-col items-center text-center"
          >
            <div
              class="w-24 h-24 rounded-2xl overflow-hidden border-2 border-white/10 p-1 mb-6 bg-white/5 shadow-inner"
            >
              <img
                src="/images/charviolet-removebg-preview.png"
                alt="Author"
                class="w-full h-full object-contain"
              />
            </div>
            <div class="space-y-4">
              <p
                class="text-[9px] font-body text-gold uppercase tracking-[0.4em] font-bold opacity-60"
                data-jp="自動手記人形"
                data-id="BONEKA MEMORI OTOMATIS"
              >
                Auto Memories Doll
              </p>
              <h2 class="font-heading text-3xl text-white leading-tight">
                Violet Evergarden
              </h2>
              <div class="w-12 h-[1px] bg-gold/20 mx-auto"></div>
              <p
                class="text-xs font-sans text-white/40 leading-relaxed italic"
                data-jp="「お客様がお望みならどこでも駆けつけます。自動手記人形サービス、ヴァイオレット・エヴァーガーデンです。」"
                data-id='"Saya akan berlari secepat mungkin ke mana pun pelanggan saya inginkan."'
              >
                "I will run as fast as I can to wherever my customer desires. I
                am the Auto Memories Doll, Violet Evergarden."
              </p>
            </div>
          </section>

          <!-- Navigation Action -->
          <a
            href="/blog/"
            class="flex items-center justify-center gap-4 py-4 rounded-2xl border border-white/5 bg-white/5 text-[10px] font-body tracking-[0.4em] uppercase text-gold hover:text-white hover:bg-gold/10 transition-all duration-300 group"
          >
            <span
              class="transform group-hover:-translate-x-2 transition-transform"
              >⟵</span
            >
            <span data-jp="戻る" data-id="KEMBALI">戻る</span>
          </a>
        </aside>

        <!-- Right Column: Content -->
        <article class="lg:col-span-8 order-1 lg:order-2">
          <div
            class="prose dark:prose-invert prose-gold max-w-none
                    prose-h2:font-heading prose-h2:text-4xl prose-h2:tracking-tight prose-h2:mb-8 prose-h2:mt-16
                    prose-p:text-[1.15rem] prose-p:leading-[2] prose-p:text-ink/90 dark:prose-p:text-white/70 prose-p:mb-8
                    prose-blockquote:border-gold/30 prose-blockquote:bg-white/5 prose-blockquote:py-6 prose-blockquote:px-10 prose-blockquote:rounded-[2rem] prose-blockquote:italic prose-blockquote:my-12
                    prose-img:rounded-[2.5rem] prose-img:shadow-2xl prose-img:my-16
                    transition-all duration-700"
            transition:animate="slide"
          >
            <Content />
          </div>
        </article>
      </div>
    </main>

    <!-- Global SVG Assets -->
    <svg class="hidden">
      <symbol id="gentle-wave" viewBox="0 24 150 28">
        <path
          d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
        ></path>
      </symbol>
    </svg>
  </article>
</Layout>
