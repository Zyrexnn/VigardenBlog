---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection, render } from "astro:content";
import { marked } from "marked";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

// Parse JP and ID markdown content from frontmatter
const bodyJpHtml = post.data.body_jp
  ? await marked.parse(post.data.body_jp)
  : "";
const bodyIdHtml = post.data.body_id
  ? await marked.parse(post.data.body_id)
  : "";
---

<Layout
  title={`${post.data.title} | Vigarden`}
  description={post.data.description}
>
  <ThemeController slot="header-right" />

  <div
    class="bg-[#3e2b22] dark:bg-[#1a110d] relative w-full h-full min-h-screen"
  >
    <!-- Wood Texture Overlay -->
    <div
      class="absolute inset-0 pointer-events-none opacity-[0.05] bg-black mix-blend-overlay z-0"
    >
    </div>

    <!-- Hero Banner -->
    <section
      class="relative h-[40vh] sm:h-[50vh] min-h-[300px] sm:min-h-[400px] w-full flex flex-col items-center justify-center text-center overflow-hidden z-10"
    >
      <div class="absolute inset-0 z-0">
        <div
          class="absolute inset-0 bg-gradient-to-tr from-gold/20 via-transparent to-transparent mix-blend-overlay"
        >
        </div>
        <div
          class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#3e2b22] dark:to-[#1a110d]"
        >
        </div>
      </div>

      <div
        class="relative z-10 max-w-4xl px-4 sm:px-8 space-y-4 sm:space-y-6 pt-16"
        transition:animate="fade"
      >
        <div
          class="flex items-center justify-center gap-3 sm:gap-4 text-[9px] sm:text-[10px] font-body text-gold tracking-[0.3em] sm:tracking-[0.4em] uppercase font-bold"
        >
          <span>{post.data.pubDate.toLocaleDateString()}</span>
          <span class="w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full bg-accent/40"
          ></span>
          <span>{post.data.category}</span>
        </div>
        <h1
          class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-heading text-paper dark:text-gold/90 drop-shadow-2xl tracking-tighter leading-tight"
          data-content-title={post.id}
        >
          <span data-content-lang="en">{post.data.title}</span>
          <span data-content-lang="jp" class="hidden"
            >{post.data.title_jp || post.data.title}</span
          >
          <span data-content-lang="id" class="hidden"
            >{post.data.title_id || post.data.title}</span
          >
        </h1>
        <div
          class="flex justify-center flex-wrap gap-1.5 sm:gap-2 pt-2 sm:pt-4"
        >
          {
            post.data.tags.map((tag: string) => (
              <span class="text-[8px] sm:text-[9px] px-2.5 sm:px-4 py-1 sm:py-1.5 rounded-full border border-ink/10 dark:border-white/10 bg-ink/5 dark:bg-white/5 text-ink/60 dark:text-white/60 uppercase tracking-widest">
                #{tag}
              </span>
            ))
          }
        </div>
      </div>

      <div
        class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none"
      >
        <svg
          class="block w-full h-10 sm:h-12 md:h-20"
          viewBox="0 24 150 28"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <path
              id="wave-post"
              d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
            ></path>
          </defs>
          <use
            href="#wave-post"
            x="48"
            y="7"
            fill="currentColor"
            class="text-[#3e2b22] dark:text-[#1a110d]"></use>
        </svg>
      </div>
    </section>

    <main
      class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 py-10 sm:py-16 relative"
    >
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 sm:gap-12 lg:gap-20">
        <!-- Left Sidebar -->
        <aside
          class="lg:col-span-4 space-y-8 sm:space-y-12 order-2 lg:order-1 lg:sticky lg:top-32"
        >
          <section
            class="bg-paper/95 dark:bg-dark-card/95 border border-gold/40 rounded-sm p-6 sm:p-10 shadow-[0_15px_30px_rgba(0,0,0,0.6)] flex flex-col items-center text-center transform -rotate-1 relative"
          >
            <!-- Wax seal decoration -->
            <div
              class="absolute -top-4 -right-2 w-10 h-10 rounded-full bg-gradient-to-br from-seal-red to-[#5a0000] shadow-[0_2px_5px_rgba(0,0,0,0.5)] border border-[#5a0000] flex items-center justify-center rotate-12 z-20"
            >
              <div
                class="w-8 h-8 border border-white/20 rounded-full flex items-center justify-center text-paper text-[8px] font-heading font-bold"
                style="box-shadow: inset 0 2px 4px rgba(0,0,0,0.4)"
              >
                V
              </div>
            </div>
            <div
              class="w-16 h-16 sm:w-24 sm:h-24 rounded-xl sm:rounded-2xl overflow-hidden border-2 border-ink/10 dark:border-white/10 p-1 mb-4 sm:mb-6 bg-ink/5 dark:bg-white/5 shadow-inner"
            >
              <img
                src="/images/charviolet-removebg-preview.png"
                alt="Author"
                class="w-full h-full object-contain"
                loading="lazy"
              />
            </div>
            <div class="space-y-3 sm:space-y-4">
              <p
                class="text-[8px] sm:text-[9px] font-body text-gold uppercase tracking-[0.3em] sm:tracking-[0.4em] font-bold opacity-80 dark:opacity-60"
                data-i18n="autoMemoriesDoll"
              >
                Auto Memories Doll
              </p>
              <h2
                class="font-heading text-2xl sm:text-3xl text-ink dark:text-white leading-tight"
              >
                Violet Evergarden
              </h2>
              <div
                class="w-10 sm:w-12 h-[1px] bg-gold/30 dark:bg-gold/20 mx-auto"
              >
              </div>
              <p
                class="text-[10px] sm:text-xs font-sans text-ink/60 dark:text-white/40 leading-relaxed italic"
                data-i18n="authorQuote"
              >
                "I will run as fast as I can to wherever my customer desires. I
                am the Auto Memories Doll, Violet Evergarden."
              </p>
            </div>
          </section>

          <a
            href="/blog/"
            class="flex items-center justify-center gap-3 w-full py-3.5 sm:py-4 rounded-full
                   bg-white/50 dark:bg-black/40 border border-gold/40 shadow-md backdrop-blur-sm
                   hover:bg-gold hover:text-white dark:hover:bg-gold dark:hover:text-ink
                   text-xs sm:text-sm font-bold uppercase tracking-[0.2em] text-ink dark:text-gold
                   transition-all duration-300 group focus:outline-none focus:ring-2 focus:ring-gold/50"
            data-i18n="back"
            data-jp="戻る"
            data-id="Kembali"
            data-en="Back"
          >
            <svg
              class="w-4 h-4 sm:w-5 sm:h-5 transform group-hover:-translate-x-1 transition-transform duration-300"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            <span
              data-i18n="back"
              data-jp="戻る"
              data-id="Kembali"
              data-en="Back"
            >
              Back
            </span>
          </a>
        </aside>

        <!-- Right Column: Article Content -->
        <article class="lg:col-span-8 order-1 lg:order-2 w-full min-w-0">
          <div
            class="bg-paper dark:bg-[#1a1c23] border border-gold/30 rounded-sm p-8 sm:p-12 md:p-16 shadow-[0_10px_30px_rgba(0,0,0,0.5)] relative overflow-hidden transform rotate-[0.5deg]"
          >
            <!-- Notebook binding spine -->
            <div
              class="absolute left-0 top-0 bottom-0 w-8 sm:w-10 bg-gradient-to-r from-[#2c1d11] via-wood to-[#2c1d11] border-r border-black/40 shadow-[5px_0_15px_rgba(0,0,0,0.5)] z-0"
            >
              <!-- Stitching -->
              <div
                class="absolute left-3 top-10 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] rotate-3"
              >
              </div>
              <div
                class="absolute left-3 top-20 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] -rotate-2"
              >
              </div>
              <div
                class="absolute left-3 top-30 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] rotate-1"
              >
              </div>
              <div
                class="absolute left-3 bottom-10 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] -rotate-3"
              >
              </div>
              <div
                class="absolute left-3 bottom-20 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] rotate-2"
              >
              </div>
              <div
                class="absolute left-3 bottom-30 w-4 h-0.5 bg-paper/60 shadow-[0_1px_1px_rgba(0,0,0,0.5)] -rotate-1"
              >
              </div>
            </div>

            <!-- Notebook Pages Effect -->
            <div
              class="absolute right-0 top-0 bottom-0 w-2 bg-gradient-to-l from-black/10 to-transparent z-0"
            >
            </div>
            <div
              class="absolute inset-x-0 bottom-0 h-2 bg-gradient-to-t from-black/10 to-transparent z-0"
            >
            </div>

            <div class="relative z-10 pl-4 sm:pl-8">
              <!-- EN Content (Markdown) -->
              <div
                class="prose prose-lg dark:prose-invert prose-gold max-w-none
                      prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14 prose-h2:text-ink dark:prose-h2:text-gold
                      prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3 prose-h3:text-ink/90 dark:prose-h3:text-gold/90
                      prose-p:font-typewriter prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/80 prose-p:mb-5
                      prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:not-italic prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                      prose-img:rounded-md sm:prose-img:rounded-lg prose-img:shadow-lg prose-img:my-8 prose-img:border prose-img:border-gold/30 prose-img:p-2 prose-img:bg-white/50 dark:prose-img:bg-black/20
                      prose-li:font-typewriter prose-li:text-ink/80 dark:prose-li:text-white/75 prose-li:leading-[1.8]
                      prose-strong:font-bold prose-strong:text-ink dark:prose-strong:text-white/90
                      prose-ol:pl-4 prose-ul:pl-4
                      prose-hr:border-ink/20 dark:prose-hr:border-white/20 prose-hr:my-8 prose-hr:border-dashed
                      relative z-10"
                transition:animate="slide"
                data-content-lang="en"
              >
                <Content />
              </div>

              <!-- JP Content -->
              {
                post.data.body_jp && (
                  <div
                    class="prose prose-lg dark:prose-invert prose-gold max-w-none
                          prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14 prose-h2:text-ink dark:prose-h2:text-gold
                          prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3 prose-h3:text-ink/90 dark:prose-h3:text-gold/90
                          prose-p:font-typewriter prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/80 prose-p:mb-5
                          prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                          prose-img:rounded-md sm:prose-img:rounded-lg prose-img:shadow-lg prose-img:my-8 prose-img:border prose-img:border-gold/30 prose-img:p-2 prose-img:bg-white/50 dark:prose-img:bg-black/20
                          prose-li:font-typewriter prose-li:text-ink/80 dark:prose-li:text-white/75 prose-li:leading-[1.8]
                          prose-strong:font-bold prose-strong:text-ink dark:prose-strong:text-white/90
                          prose-ol:pl-4 prose-ul:pl-4
                          prose-hr:border-ink/20 dark:prose-hr:border-white/20 prose-hr:my-8 prose-hr:border-dashed
                          relative z-10
                          hidden"
                    data-content-lang="jp"
                    set:html={bodyJpHtml}
                  />
                )
              }

              <!-- ID Content -->
              {
                post.data.body_id && (
                  <div
                    class="prose prose-lg dark:prose-invert prose-gold max-w-none
                          prose-h2:font-heading prose-h2:text-2xl sm:prose-h2:text-3xl prose-h2:tracking-tight prose-h2:mb-5 sm:prose-h2:mb-7 prose-h2:mt-8 sm:prose-h2:mt-14 prose-h2:text-ink dark:prose-h2:text-gold
                          prose-h3:font-heading prose-h3:text-xl sm:prose-h3:text-2xl prose-h3:mt-6 sm:prose-h3:mt-10 prose-h3:mb-3 prose-h3:text-ink/90 dark:prose-h3:text-gold/90
                          prose-p:font-typewriter prose-p:text-[0.95rem] sm:prose-p:text-[1.05rem] prose-p:leading-[1.9] prose-p:text-ink/85 dark:prose-p:text-white/80 prose-p:mb-5
                          prose-blockquote:border-l-4 prose-blockquote:border-gold/40 prose-blockquote:bg-ink/[0.03] dark:prose-blockquote:bg-white/[0.04] prose-blockquote:py-3 prose-blockquote:px-5 prose-blockquote:rounded-r-lg prose-blockquote:italic prose-blockquote:my-6 prose-blockquote:text-ink/70 dark:prose-blockquote:text-white/60
                          prose-img:rounded-md sm:prose-img:rounded-lg prose-img:shadow-lg prose-img:my-8 prose-img:border prose-img:border-gold/30 prose-img:p-2 prose-img:bg-white/50 dark:prose-img:bg-black/20
                          prose-li:font-typewriter prose-li:text-ink/80 dark:prose-li:text-white/75 prose-li:leading-[1.8]
                          prose-strong:font-bold prose-strong:text-ink dark:prose-strong:text-white/90
                          prose-ol:pl-4 prose-ul:pl-4
                          prose-hr:border-ink/20 dark:prose-hr:border-white/20 prose-hr:my-8 prose-hr:border-dashed
                          relative z-10
                          hidden"
                    data-content-lang="id"
                    set:html={bodyIdHtml}
                  />
                )
              }
            </div>
          </div>
        </article>
      </div>
    </main>
  </div>
</Layout>
