---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Layout title="手紙の記録 (Archive) | Vigarden">
  <ThemeController slot="header-right" />

  <!-- Single background wrapper — prevents color bleed between hero and content -->
  <div class="bg-paper dark:bg-[#0D1117] relative">
    <!-- Archive Banner -->
    <section
      class="relative h-[45vh] min-h-[350px] w-full flex flex-col items-center justify-center text-center overflow-hidden"
    >
      <div class="absolute inset-0 z-0">
        <img
          src="/images/violet-dark.gif"
          alt=""
          class="w-full h-full object-cover opacity-10 dark:opacity-20 blur-[1px] scale-110 translate-y-2"
        />
        <div
          class="absolute inset-0 bg-gradient-to-b from-ink/10 via-transparent to-paper dark:to-[#0D1117]"
        >
        </div>
      </div>

      <div class="relative z-10 space-y-4 px-6" transition:animate="fade">
        <h1
          class="text-6xl md:text-8xl font-heading text-ink dark:text-white drop-shadow-2xl tracking-tighter"
          data-jp="手紙の記録"
          data-id="Arsip Surat"
          data-en="Letter Archive"
        >
          手紙 of Memories
        </h1>
        <p
          class="text-ink/40 dark:text-white/40 font-body text-[10px] sm:text-xs tracking-[0.5em] uppercase"
          data-i18n="archiveSubtitle"
          data-jp="— The Archive of Memories —"
          data-id="— Arsip Kenangan —"
          data-en="— The Archive of Memories —"
        >
          — The Archive of Memories —
        </p>
      </div>

      <!-- Wave Divider -->
      <div
        class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none"
      >
        <svg
          class="block w-full h-12 md:h-20"
          viewBox="0 24 150 28"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <path
              id="archive-wave"
              d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
            ></path>
          </defs>
          <use
            href="#archive-wave"
            x="48"
            y="7"
            fill="currentColor"
            class="text-paper dark:text-[#0D1117]"></use>
        </svg>
      </div>
    </section>

    <!-- Main Content — same bg as wrapper, no z-conflict -->
    <main
      class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 py-10 sm:py-16 relative"
    >
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 sm:gap-12 lg:gap-20">
        <!-- Left Sidebar -->
        <aside class="lg:col-span-4 space-y-8 sm:space-y-12 order-2 lg:order-1">
          <div class="sticky top-32 space-y-8 sm:space-y-12">
            <!-- Categories Card -->
            <section
              class="bg-white/90 dark:bg-[#161213]/80 border border-ink/10 dark:border-white/5 rounded-2xl sm:rounded-[2.5rem] p-6 sm:p-10 shadow-2xl"
            >
              <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-10">
                <div class="w-1 h-5 sm:h-6 bg-accent/40 rounded-full"></div>
                <h3
                  class="font-heading text-base sm:text-lg text-ink/80 dark:text-white/80 uppercase tracking-widest"
                  data-i18n="categories"
                >
                  <span data-content-lang="en">Categories</span>
                  <span data-content-lang="jp" class="hidden">カテゴリー</span>
                  <span data-content-lang="id" class="hidden">Kategori</span>
                </h3>
              </div>
              <ul class="space-y-5 text-xs font-sans">
                <li
                  class="flex justify-between items-center group cursor-pointer border-b border-ink/10 dark:border-white/5 pb-4"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="letters"
                    data-jp="手紙"
                    data-id="Surat"
                    data-en="Letters">Letters</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >5</span
                  >
                </li>
                <li
                  class="flex justify-between items-center group cursor-pointer border-b border-ink/10 dark:border-white/5 pb-4"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="memories"
                    data-jp="思い出"
                    data-id="Kenangan"
                    data-en="Memories">Memories</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >3</span
                  >
                </li>
                <li
                  class="flex justify-between items-center group cursor-pointer"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="service"
                    data-jp="サービス"
                    data-id="Layanan"
                    data-en="Service">Service</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >2</span
                  >
                </li>
              </ul>
            </section>

            <!-- Popular Posts Card -->
            <section
              class="bg-white/90 dark:bg-[#161213]/80 border border-ink/10 dark:border-white/5 rounded-2xl sm:rounded-[2.5rem] p-6 sm:p-10 shadow-2xl"
            >
              <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-10">
                <div class="w-1 h-5 sm:h-6 bg-gold/40 rounded-full"></div>
                <h3
                  class="font-heading text-base sm:text-lg text-ink/80 dark:text-white/80 uppercase tracking-widest"
                  data-i18n="popularPosts"
                >
                  <span data-content-lang="en">Popular Letters</span>
                  <span data-content-lang="jp" class="hidden">人気の手紙</span>
                  <span data-content-lang="id" class="hidden"
                    >Surat Populer</span
                  >
                </h3>
              </div>
              <ul class="space-y-6 sm:space-y-8 text-xs font-sans">
                {
                  sortedPosts.slice(0, 3).map((p) => (
                    <li>
                      <a
                        href={`/blog/${p.id}/`}
                        class="block group transition-all"
                      >
                        <p class="text-[9px] text-gold/60 dark:text-gold/40 uppercase tracking-[0.2em] mb-2 font-bold group-hover:text-gold transition-colors">
                          {p.data.pubDate.toLocaleDateString()}
                        </p>
                        <p class="text-ink/70 dark:text-white/50 group-hover:text-ink dark:group-hover:text-white transition-colors line-clamp-2 font-medium leading-relaxed">
                          <span data-content-lang="en">{p.data.title}</span>
                          <span data-content-lang="jp" class="hidden">
                            {p.data.title_jp || p.data.title}
                          </span>
                          <span data-content-lang="id" class="hidden">
                            {p.data.title_id || p.data.title}
                          </span>
                        </p>
                      </a>
                    </li>
                  ))
                }
              </ul>
            </section>
          </div>
        </aside>

        <!-- Right: Post List -->
        <div class="lg:col-span-8 space-y-6 sm:space-y-10 order-1 lg:order-2">
          <div class="space-y-6 sm:space-y-8" transition:animate="slide">
            {
              sortedPosts.map((post) => (
                <a href={`/blog/${post.id}/`} class="group block">
                  <article class="relative bg-white/90 dark:bg-[#1e1a1b]/80 border border-ink/10 dark:border-white/5 rounded-2xl sm:rounded-[2.5rem] p-5 sm:p-8 md:p-12 flex flex-col md:flex-row gap-6 sm:gap-10 hover:shadow-2xl transition-colors duration-300 group-hover:-translate-y-1">
                    <div class="flex-1 space-y-4 sm:space-y-6">
                      <div class="flex flex-wrap items-center gap-3 sm:gap-6 text-[9px] font-body text-gold/60 tracking-[0.3em] uppercase font-bold">
                        <span class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 rounded-full bg-accent/30" />
                          {post.data.pubDate.toLocaleDateString("en-US", {
                            month: "short",
                            day: "numeric",
                            year: "numeric",
                          })}
                        </span>
                        <span>{post.data.category}</span>
                      </div>
                      <h2 class="text-2xl sm:text-3xl md:text-4xl font-heading text-primary dark:text-white/90 group-hover:text-gold dark:group-hover:text-accent transition-colors duration-500 leading-tight">
                        <span data-content-lang="en">{post.data.title}</span>
                        <span data-content-lang="jp" class="hidden">
                          {post.data.title_jp || post.data.title}
                        </span>
                        <span data-content-lang="id" class="hidden">
                          {post.data.title_id || post.data.title}
                        </span>
                      </h2>
                      <p class="text-ink/60 dark:text-white/40 font-sans leading-relaxed line-clamp-2 text-sm sm:text-base italic pr-4 sm:pr-12">
                        <span data-content-lang="en">
                          {post.data.description}
                        </span>
                        <span data-content-lang="jp" class="hidden">
                          {post.data.description_jp || post.data.description}
                        </span>
                        <span data-content-lang="id" class="hidden">
                          {post.data.description_id || post.data.description}
                        </span>
                      </p>
                    </div>
                    <div class="shrink-0 flex items-center justify-end md:justify-center">
                      <div class="w-12 h-12 sm:w-14 sm:h-14 rounded-xl sm:rounded-2xl border border-white/5 bg-white/5 flex items-center justify-center group-hover:bg-accent group-hover:text-white transition-all duration-500 shadow-xl group-hover:scale-110">
                        <span class="text-lg sm:text-xl transform group-hover:translate-x-1 transition-transform">
                          ⟶
                        </span>
                      </div>
                    </div>
                    <div class="absolute left-0 top-12 bottom-12 w-0.5 bg-accent/0 group-hover:bg-accent/40 transition-all" />
                  </article>
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </main>
  </div>
</Layout>
