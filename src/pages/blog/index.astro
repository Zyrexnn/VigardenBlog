---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Layout title="ÊâãÁ¥ô„ÅÆË®òÈå≤ (Archive) | Vigarden">
  <ThemeController slot="header-right" />

  <!-- Archive Banner (Matching Home aesthetic but simpler) -->
  <section
    class="relative h-[40vh] min-h-[300px] w-full flex flex-col items-center justify-center text-center overflow-hidden bg-[#0D1117]"
  >
    <div class="absolute inset-0 z-0">
      <img
        src="/images/violet-dark.gif"
        alt=""
        class="w-full h-full object-cover opacity-30 blur-sm scale-110"
      />
      <div
        class="absolute inset-0 bg-gradient-to-b from-black/60 to-transparent"
      >
      </div>
    </div>

    <div class="z-10 space-y-4 px-6 pt-16" transition:animate="fade">
      <h1
        class="text-5xl md:text-7xl font-heading text-white drop-shadow-lg tracking-tighter"
      >
        ÊâãÁ¥ô„ÅÆË®òÈå≤
      </h1>
      <p class="text-white/60 font-body text-xs tracking-[0.5em] uppercase">
        ‚Äî The Archive of Memories ‚Äî
      </p>
    </div>

    <!-- Wavy Divider -->
    <div
      class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20"
    >
      <svg class="w-full h-16" viewBox="0 24 150 28" preserveAspectRatio="none">
        <use
          href="#gentle-wave"
          x="48"
          y="7"
          fill="currentColor"
          class="text-paper dark:text-dark-bg"></use>
      </svg>
    </div>
  </section>

  <main class="max-w-7xl mx-auto px-6 sm:px-8 lg:px-12 py-20 relative z-30">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-16">
      <!-- Left: Post List -->
      <div class="lg:col-span-8 space-y-12">
        <div class="space-y-8" transition:animate="slide">
          {
            sortedPosts.map((post) => (
              <a href={`/blog/${post.id}/`} class="group block">
                <article class="relative bg-white dark:bg-dark-card border border-gold/5 dark:border-white/5 rounded-[2.5rem] p-10 flex flex-col md:flex-row gap-10 hover:shadow-2xl transition-all duration-700 backdrop-blur-md group-hover:-translate-y-2">
                  <div class="absolute top-10 left-0 w-1.5 h-20 bg-gold/10 group-hover:bg-accent transition-all duration-500 rounded-r-full" />

                  <div class="flex-1 space-y-6">
                    <div class="flex flex-wrap items-center gap-6 text-[10px] font-body text-ink/40 dark:text-white/30 tracking-widest uppercase font-bold">
                      <span>
                        üìÖ{" "}
                        {post.data.pubDate.toLocaleDateString("en-US", {
                          month: "short",
                          day: "numeric",
                          year: "numeric",
                        })}
                      </span>
                      <span>üè∑Ô∏è {post.data.category}</span>
                    </div>

                    <h2 class="text-3xl font-heading text-primary dark:text-dark-text group-hover:text-gold dark:group-hover:text-accent transition-colors duration-500">
                      {post.data.title}
                    </h2>

                    <p class="text-ink/60 dark:text-white/50 font-sans leading-relaxed line-clamp-2 text-lg">
                      {post.data.description}
                    </p>
                  </div>

                  <div class="shrink-0 flex items-center justify-center">
                    <div class="w-16 h-16 rounded-3xl border border-gold/10 dark:border-white/10 flex items-center justify-center group-hover:bg-accent group-hover:text-white transition-all duration-500 shadow-lg">
                      <span class="text-2xl transform group-hover:translate-x-1 transition-transform">
                        ‚Üí
                      </span>
                    </div>
                  </div>
                </article>
              </a>
            ))
          }
        </div>
      </div>

      <!-- Right: Sidebar (Tidied) -->
      <aside class="lg:col-span-4 space-y-10">
        <div class="sticky top-32 space-y-10">
          <div
            class="bg-white/40 dark:bg-dark-card/40 border border-gold/5 dark:border-white/5 rounded-[2.5rem] p-10 backdrop-blur-xl shadow-xl"
          >
            <div class="flex items-center gap-3 mb-8">
              <div class="w-1 h-5 bg-accent rounded-full"></div>
              <h3 class="font-heading text-xl uppercase tracking-wider">
                „Ç´„ÉÜ„Ç¥„É™„Éº
              </h3>
            </div>
            <ul class="space-y-4 text-sm font-sans">
              {
                ["Letters", "Memories", "Service"].map((cat) => (
                  <li class="flex justify-between items-center group cursor-pointer">
                    <span class="text-ink/60 dark:text-white/50 group-hover:text-accent transition-colors">
                      {cat}
                    </span>
                    <span class="text-[10px] bg-gold/10 px-2 py-0.5 rounded-full opacity-60">
                      5
                    </span>
                  </li>
                ))
              }
            </ul>
          </div>

          <div
            class="bg-white/40 dark:bg-dark-card/40 border border-gold/5 dark:border-white/5 rounded-[2.5rem] p-10 backdrop-blur-xl shadow-xl"
          >
            <h3 class="font-heading text-xl mb-6">‰∫∫Ê∞ó„ÅÆÊâãÁ¥ô</h3>
            <ul class="space-y-6 text-sm font-sans">
              {
                sortedPosts.slice(0, 3).map((p) => (
                  <li>
                    <a
                      href={`/blog/${p.id}/`}
                      class="block group transition-all"
                    >
                      <p class="text-[10px] text-gold/60 uppercase tracking-widest mb-1">
                        {p.data.pubDate.toLocaleDateString()}
                      </p>
                      <p class="group-hover:text-accent transition-colors line-clamp-2 font-medium leading-snug">
                        {p.data.title}
                      </p>
                    </a>
                  </li>
                ))
              }
            </ul>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <svg class="hidden">
    <symbol id="gentle-wave" viewBox="0 24 150 28">
      <path
        d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
      ></path>
    </symbol>
  </svg>
</Layout>
