---
import Layout from "../../layouts/Layout.astro";
import ThemeController from "../../components/ThemeController.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog", ({ data }) => !data.draft);
const sortedPosts = posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<Layout title="手紙の記録 (Archive) | Vigarden">
  <ThemeController slot="header-right" />

  <!-- Single background wrapper — prevents color bleed between hero and content -->
  <div class="bg-paper dark:bg-[#0D1117] relative">
    <!-- Archive Banner -->
    <section
      class="relative h-[45vh] min-h-[350px] w-full flex flex-col items-center justify-center text-center overflow-hidden bg-gradient-to-b from-paper/40 via-gold/10 to-paper dark:from-dark-bg/80 dark:via-dark-card/50 dark:to-[#0D1117]"
    >
      <div class="absolute inset-0 z-0">
        <div
          class="absolute inset-0 bg-gradient-to-tr from-gold/20 via-transparent to-transparent mix-blend-overlay"
        ></div>
        <div
          class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-paper dark:to-[#0D1117]"
        ></div>
      </div>

      <div class="relative z-10 space-y-4 px-6" transition:animate="fade">
        <h1
          class="text-6xl md:text-8xl font-heading text-ink dark:text-white drop-shadow-2xl tracking-tighter"
          data-jp="手紙の記録"
          data-id="Arsip Surat"
          data-en="Letter Archive"
        >
          手紙 of Memories
        </h1>
        <p
          class="text-ink/40 dark:text-white/40 font-body text-[10px] sm:text-xs tracking-[0.5em] uppercase"
          data-i18n="archiveSubtitle"
          data-jp="— The Archive of Memories —"
          data-id="— Arsip Kenangan —"
          data-en="— The Archive of Memories —"
        >
          — The Archive of Memories —
        </p>
      </div>

      <!-- Wave Divider -->
      <div
        class="absolute bottom-0 left-0 w-full overflow-hidden leading-[0] z-20 pointer-events-none"
      >
        <svg
          class="block w-full h-12 md:h-20"
          viewBox="0 24 150 28"
          preserveAspectRatio="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <defs>
            <path
              id="archive-wave"
              d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"
            ></path>
          </defs>
          <use
            href="#archive-wave"
            x="48"
            y="7"
            fill="currentColor"
            class="text-paper dark:text-[#0D1117]"></use>
        </svg>
      </div>
    </section>

    <!-- Main Content — same bg as wrapper, no z-conflict -->
    <main
      class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-12 py-10 sm:py-16 relative"
    >
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 sm:gap-12 lg:gap-20">
        <!-- Left Sidebar -->
        <aside class="lg:col-span-4 space-y-8 sm:space-y-12 order-2 lg:order-1">
          <div class="sticky top-32 space-y-8 sm:space-y-12">
            <!-- Categories Card -->
            <section
              class="bg-paper dark:bg-dark-card border border-gold/40 shadow-[0_5px_15px_rgba(0,0,0,0.1)] relative p-6 sm:p-10"
            >
              <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-10">
                <div class="w-1 h-5 sm:h-6 bg-accent/40 rounded-full"></div>
                <h3
                  class="font-heading text-base sm:text-lg text-ink/80 dark:text-white/80 uppercase tracking-widest"
                  data-i18n="categories"
                >
                  <span data-content-lang="en">Categories</span>
                  <span data-content-lang="jp" class="hidden">カテゴリー</span>
                  <span data-content-lang="id" class="hidden">Kategori</span>
                </h3>
              </div>
              <ul class="space-y-5 text-xs font-sans">
                <li
                  class="flex justify-between items-center group cursor-pointer border-b border-ink/10 dark:border-white/5 pb-4"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="letters"
                    data-jp="手紙"
                    data-id="Surat"
                    data-en="Letters">Letters</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >5</span
                  >
                </li>
                <li
                  class="flex justify-between items-center group cursor-pointer border-b border-ink/10 dark:border-white/5 pb-4"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="memories"
                    data-jp="思い出"
                    data-id="Kenangan"
                    data-en="Memories">Memories</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >3</span
                  >
                </li>
                <li
                  class="flex justify-between items-center group cursor-pointer"
                >
                  <span
                    class="text-ink/60 dark:text-white/40 group-hover:text-accent transition-colors tracking-wide"
                    data-i18n="service"
                    data-jp="サービス"
                    data-id="Layanan"
                    data-en="Service">Service</span
                  >
                  <span
                    class="text-[9px] bg-ink/5 dark:bg-white/5 px-3 py-1 rounded-full opacity-60 dark:opacity-40 group-hover:opacity-100 transition-opacity"
                    >2</span
                  >
                </li>
              </ul>
            </section>

            <!-- Popular Posts Card -->
            <section
              class="bg-paper dark:bg-dark-card border border-gold/40 shadow-[0_5px_15px_rgba(0,0,0,0.1)] relative p-6 sm:p-10"
            >
              <div class="flex items-center gap-3 sm:gap-4 mb-6 sm:mb-10">
                <div class="w-1 h-5 sm:h-6 bg-gold/40 rounded-full"></div>
                <h3
                  class="font-heading text-base sm:text-lg text-ink/80 dark:text-white/80 uppercase tracking-widest"
                  data-i18n="popularPosts"
                >
                  <span data-content-lang="en">Popular Letters</span>
                  <span data-content-lang="jp" class="hidden">人気の手紙</span>
                  <span data-content-lang="id" class="hidden"
                    >Surat Populer</span
                  >
                </h3>
              </div>
              <ul class="space-y-6 sm:space-y-8 text-xs font-sans">
                {
                  sortedPosts.slice(0, 3).map((p) => (
                    <li>
                      <a
                        href={`/blog/${p.id}/`}
                        class="block group transition-all"
                      >
                        <p class="text-[9px] text-gold/60 dark:text-gold/40 uppercase tracking-[0.2em] mb-2 font-bold group-hover:text-gold transition-colors">
                          {p.data.pubDate.toLocaleDateString()}
                        </p>
                        <p class="text-ink/70 dark:text-white/50 group-hover:text-ink dark:group-hover:text-white transition-colors line-clamp-2 font-medium leading-relaxed">
                          <span data-content-lang="en">{p.data.title}</span>
                          <span data-content-lang="jp" class="hidden">
                            {p.data.title_jp || p.data.title}
                          </span>
                          <span data-content-lang="id" class="hidden">
                            {p.data.title_id || p.data.title}
                          </span>
                        </p>
                      </a>
                    </li>
                  ))
                }
              </ul>
            </section>
          </div>
        </aside>

        <!-- Right: Post List -->
        <div class="lg:col-span-8 space-y-10 sm:space-y-16 order-1 lg:order-2">
          <div class="space-y-12 sm:space-y-16" transition:animate="slide">
            {
              sortedPosts.map((post, index) => (
                <a href={`/blog/${post.id}/`} class="group block relative perspective-1000">
                  <article class={`relative bg-paper dark:bg-dark-card border border-gold/40 dark:border-wood/80 shadow-[0_5px_15px_rgba(0,0,0,0.1)] dark:shadow-[0_10px_30px_rgba(0,0,0,0.4)] p-6 sm:p-10 flex flex-col md:flex-row gap-6 sm:gap-10 hover:shadow-2xl transition-all duration-700 hover:-translate-y-2 origin-bottom ${index % 2 === 0 ? 'rotate-[-1deg]' : 'rotate-[1deg]'}`}>
                    
                    <!-- Back pages (Stack effect) -->
                    <div class={`absolute inset-0 bg-paper/80 dark:bg-dark-card/80 border border-gold/20 -z-10 shadow-sm transition-transform duration-700 group-hover:rotate-0 ${index % 2 === 0 ? 'rotate-1 scale-[0.98]' : '-rotate-1 scale-[0.98]'}`}></div>
                    <div class={`absolute inset-0 bg-paper/60 dark:bg-dark-card/60 border border-gold/10 -z-20 shadow-sm transition-transform duration-700 group-hover:rotate-0 ${index % 2 === 0 ? 'rotate-2 scale-[0.96]' : '-rotate-2 scale-[0.96]'}`}></div>
                    
                    <!-- Vertical Ribbon -->
                    <div class="absolute left-8 sm:left-12 top-[-10px] bottom-[-10px] w-5 bg-accent/80 dark:bg-seal-red/80 shadow-[2px_0_5px_rgba(0,0,0,0.3)] opacity-90 group-hover:opacity-100 group-hover:scale-y-105 transition-all duration-500 z-10 flex flex-col justify-between items-center py-2">
                       <div class="w-2 h-2 rounded-full border border-white/40"></div>
                       <div class="w-2 h-2 rounded-full border border-white/40 xl:block hidden"></div>
                    </div>

                    <div class="flex-1 space-y-4 sm:space-y-6 pl-8 sm:pl-16 relative z-10">
                      <div class="flex flex-wrap items-center gap-3 sm:gap-6 text-[10px] font-body text-wood/80 dark:text-gold/60 tracking-[0.3em] uppercase font-bold">
                        <span class="flex items-center gap-2">
                          <span class="w-1.5 h-1.5 rounded-full bg-accent/30 dark:bg-gold/30" />
                          {post.data.pubDate.toLocaleDateString("en-US", {
                            month: "short",
                            day: "numeric",
                            year: "numeric",
                          })}
                        </span>
                        <span class="border-l border-gold/40 pl-4">{post.data.category}</span>
                      </div>
                      <h2 class="text-2xl sm:text-3xl md:text-3xl font-heading text-ink dark:text-white/90 group-hover:text-gold dark:group-hover:text-accent transition-colors duration-500 leading-tight">
                        <span data-content-lang="en">{post.data.title}</span>
                        <span data-content-lang="jp" class="hidden">
                          {post.data.title_jp || post.data.title}
                        </span>
                        <span data-content-lang="id" class="hidden">
                          {post.data.title_id || post.data.title}
                        </span>
                      </h2>
                      <p class="text-ink/60 dark:text-white/40 font-typewriter leading-relaxed line-clamp-3 text-sm sm:text-base pr-4 sm:pr-12 group-hover:text-ink/80 transition-colors">
                        <span data-content-lang="en">
                          {post.data.description}
                        </span>
                        <span data-content-lang="jp" class="hidden">
                          {post.data.description_jp || post.data.description}
                        </span>
                        <span data-content-lang="id" class="hidden">
                          {post.data.description_id || post.data.description}
                        </span>
                      </p>
                    </div>
                    
                    <div class="shrink-0 flex items-center justify-end md:justify-center relative z-10">
                      <!-- Wax Seal link button -->
                      <div class="w-12 h-12 rounded-full bg-gradient-to-br from-seal-red to-[#5a0000] shadow-[0_4px_10px_rgba(139,0,0,0.4)] border-2 border-[#5a0000]/50 flex items-center justify-center group-hover:scale-110 group-hover:rotate-12 transition-all duration-500 text-paper text-sm font-heading relative overflow-hidden">
                        <div class="absolute inset-1 border border-white/20 rounded-full"></div>
                        <span class="transform transition-transform text-white/90">V</span>
                      </div>
                    </div>
                  </article>
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </main>
  </div>
</Layout>
