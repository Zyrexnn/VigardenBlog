---
/**
 * VioletHero.astro
 * Interactive hero: iris tracks the cursor behind the open eye.
 * Optimized: no animejs, uses CSS transitions and requestAnimationFrame.
 */
---

<div
  id="violet-hero"
  class="violet-hero-container relative w-[250px] h-[350px] sm:w-[350px] sm:h-[450px] select-none"
  transition:name="violet-hero"
>
  <!-- Z-0: Eye Iris -->
  <div class="absolute inset-0 z-0 pointer-events-none">
    <div
      class="iris iris-main absolute rounded-full"
      style="
        width: 30px; height: 30px;
        top: 34.5%; left: 63.5%;
        background: radial-gradient(circle at 40% 40%, #4facfe 0%, #0077cc 55%, #003366 100%);
        box-shadow: 0 0 15px rgba(79,172,254,0.6), inset 0 0 5px rgba(0,0,0,0.4);
        transform: translate(-50%, -50%);
        transition: transform 0.15s ease-out;
      "
    >
      <div
        class="absolute rounded-full bg-black"
        style="width: 10px; height: 10px; top: 50%; left: 50%; transform: translate(-50%,-50%);"
      >
      </div>
      <div
        class="absolute rounded-full bg-white/80"
        style="width: 6px; height: 6px; top: 25%; left: 60%;"
      >
      </div>
    </div>
  </div>

  <!-- Z-10: Face Image -->
  <img
    src="/images/charviolet-removebg-preview.png"
    alt="Violet Evergarden"
    class="absolute inset-0 w-full h-full object-contain z-10 pointer-events-none drop-shadow-2xl"
    loading="eager"
    width="350"
    height="450"
  />

  <!-- Z-20: Eyelid -->
  <div class="absolute inset-0 z-20 pointer-events-none">
    <div
      class="eyelid eyelid-main absolute bg-[#f5d9c6] dark:bg-[#d4a98a] origin-top"
      style="
        width: 35px; height: 25px;
        top: 32%; left: 60%;
        border-radius: 50%;
        transform: scaleY(0);
        transition: transform 0.1s ease-in-out;
      "
    >
    </div>
  </div>
</div>

<script>
  function initHero(): void {
    const hero = document.getElementById("violet-hero");
    if (!hero) return;

    const iris = hero.querySelector(".iris-main") as HTMLElement | null;
    const eyelid = hero.querySelector(".eyelid-main") as HTMLElement | null;
    const canHover = window.matchMedia("(hover: hover)").matches;

    // Eye tracking — CSS transition handles smoothing
    if (iris && canHover) {
      window.addEventListener("mousemove", (e: MouseEvent) => {
        const rect = hero.getBoundingClientRect();
        const eyeX = rect.left + rect.width * 0.635;
        const eyeY = rect.top + rect.height * 0.345;
        const dx = e.clientX - eyeX;
        const dy = e.clientY - eyeY;
        const angle = Math.atan2(dy, dx);
        const dist = Math.min(6, Math.hypot(dx, dy) / 40);
        iris.style.transform = `translate(-50%, -50%) translate(${Math.cos(angle) * dist}px, ${Math.sin(angle) * dist}px)`;
      });
    }

    // Blink — CSS transitions, no animejs
    function blink(): void {
      if (!eyelid) return;
      eyelid.style.transform = "scaleY(1)";
      setTimeout(() => {
        eyelid.style.transform = "scaleY(0)";
        setTimeout(blink, 3000 + Math.random() * 5000);
      }, 150);
    }

    setTimeout(blink, 2000);
  }

  initHero();
  document.addEventListener("astro:after-swap", initHero);
</script>
